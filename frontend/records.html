<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Atmos Weather • Records</title>
    <meta name="description" content="Manage saved weather query records with full CRUD operations." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { "primary": "#2b6cee", "bg-dark": "#101622" },
                    fontFamily: { "display": ["Manrope", "sans-serif"] },
                    borderRadius: { DEFAULT: "0.5rem", lg: "1rem", xl: "1.5rem", "2xl": "1.75rem", full: "9999px" },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Manrope', sans-serif;
            background: linear-gradient(160deg, #0b1430, #111d3f 45%, #1d2c5f);
            min-height: 100vh;
        }

        .glass-panel {
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            background: linear-gradient(135deg, rgba(30, 41, 59, .42), rgba(15, 23, 42, .32));
            border: 1px solid rgba(255, 255, 255, .1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, .28);
            transition: border-color .3s, background .3s, box-shadow .3s;
        }

        .glass-panel:hover {
            border-color: rgba(255, 255, 255, .18);
            background: linear-gradient(135deg, rgba(30, 41, 59, .5), rgba(15, 23, 42, .4));
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, .05)
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, .2);
            border-radius: 3px
        }

        @keyframes fade-up {
            from {
                opacity: 0;
                transform: translateY(16px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        @keyframes slide-in-right {
            from {
                opacity: 0;
                transform: translateX(16px)
            }

            to {
                opacity: 1;
                transform: translateX(0)
            }
        }

        .anim-fade-up {
            animation: fade-up .5s cubic-bezier(.22, 1, .36, 1) both
        }

        .anim-slide-in {
            animation: slide-in-right .4s cubic-bezier(.22, 1, .36, 1) both
        }

        .anim-d1 {
            animation-delay: .1s
        }

        .anim-d2 {
            animation-delay: .2s
        }

        .record-item {
            transition: all .3s cubic-bezier(.22, 1, .36, 1);
            border: 1px solid rgba(255, 255, 255, .1);
        }

        .record-item:hover {
            border-color: rgba(255, 255, 255, .2);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, .25);
        }

        #error {
            transition: opacity .3s, transform .3s
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1) brightness(0.8);
        }
    </style>
</head>

<body class="text-slate-100 min-h-screen relative antialiased overflow-x-hidden">
    <div class="relative z-10 flex flex-col min-h-screen w-full">

        <!-- Header -->
        <header class="glass-panel sticky top-0 z-50 flex flex-wrap items-center justify-between px-5 py-3 lg:px-8"
            style="border-radius:0;">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-primary/80 rounded-lg shadow-lg shadow-primary/20">
                    <span class="material-symbols-outlined text-white text-2xl">cloud</span>
                </div>
                <h1 class="text-xl font-bold tracking-tight text-white">Atmos Weather</h1>
            </div>
            <div class="flex items-center gap-3">
                <nav class="flex gap-1.5 text-sm">
                    <a class="px-3 py-2 rounded-lg hover:bg-white/10 text-slate-300 transition-colors"
                        href="current.html">Current</a>
                    <a class="px-3 py-2 rounded-lg hover:bg-white/10 text-slate-300 transition-colors"
                        href="forecast.html">Forecast</a>
                    <a class="px-3 py-2 rounded-lg bg-primary/20 border border-primary/30 text-white font-medium"
                        href="records.html">Records</a>
                </nav>
            </div>
        </header>

        <!-- Main -->
        <main class="flex-grow p-4 lg:p-8 pt-4 w-full max-w-[1200px] mx-auto flex flex-col gap-6">

            <!-- Page Title -->
            <div class="anim-fade-up">
                <h2 class="text-2xl font-bold text-white tracking-tight flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">database</span> Weather Records
                </h2>
                <p class="text-slate-400 text-sm mt-1">Create, update, and manage your saved weather queries.</p>
            </div>

            <!-- Create Form -->
            <div class="glass-panel rounded-2xl p-6 anim-fade-up anim-d1">
                <h3 class="text-white font-semibold mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg text-emerald-400">add_circle</span> New Record
                </h3>
                <div class="flex flex-wrap gap-3 items-end">
                    <div class="flex flex-col gap-1.5 flex-1 min-w-[180px]">
                        <label class="text-xs text-slate-400 font-medium uppercase tracking-wider">Location</label>
                        <div class="relative">
                            <span
                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 !text-[18px]">location_on</span>
                            <input id="qLocation"
                                class="block w-full pl-9 pr-3 py-2.5 border-none rounded-xl bg-white/10 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:bg-white/15 transition-all text-sm"
                                placeholder="Enter city name" autocomplete="off" />
                        </div>
                    </div>
                    <div class="flex flex-col gap-1.5">
                        <label class="text-xs text-slate-400 font-medium uppercase tracking-wider">Start Date</label>
                        <input id="startDate" type="date"
                            class="block px-3 py-2.5 border-none rounded-xl bg-white/10 text-white focus:outline-none focus:ring-2 focus:ring-primary/50 focus:bg-white/15 transition-all text-sm" />
                    </div>
                    <div class="flex flex-col gap-1.5">
                        <label class="text-xs text-slate-400 font-medium uppercase tracking-wider">End Date</label>
                        <input id="endDate" type="date"
                            class="block px-3 py-2.5 border-none rounded-xl bg-white/10 text-white focus:outline-none focus:ring-2 focus:ring-primary/50 focus:bg-white/15 transition-all text-sm" />
                    </div>
                    <button id="createBtn"
                        class="px-5 py-2.5 rounded-xl bg-primary/70 hover:bg-primary text-white font-semibold transition-all shadow-lg shadow-primary/20 flex items-center gap-2">
                        <span class="material-symbols-outlined !text-[18px]">add</span> Create
                    </button>
                </div>
                <p id="error" class="text-rose-300 text-sm font-semibold mt-2 h-5 opacity-0"
                    style="transform:translateY(-4px);"></p>
            </div>

            <!-- Actions Row -->
            <div class="flex flex-wrap gap-3 anim-fade-up anim-d2">
                <button id="refreshBtn"
                    class="px-4 py-2 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 text-slate-300 font-medium transition-all flex items-center gap-2 text-sm">
                    <span class="material-symbols-outlined !text-[18px]">refresh</span> Refresh
                </button>
                <button id="exportJson"
                    class="px-4 py-2 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 text-slate-300 font-medium transition-all flex items-center gap-2 text-sm">
                    <span class="material-symbols-outlined !text-[18px]">code</span> JSON
                </button>
                <button id="exportCsv"
                    class="px-4 py-2 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 text-slate-300 font-medium transition-all flex items-center gap-2 text-sm">
                    <span class="material-symbols-outlined !text-[18px]">table_chart</span> CSV
                </button>
                <button id="exportMd"
                    class="px-4 py-2 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 text-slate-300 font-medium transition-all flex items-center gap-2 text-sm">
                    <span class="material-symbols-outlined !text-[18px]">description</span> Markdown
                </button>
            </div>

            <!-- Records List -->
            <div class="glass-panel rounded-2xl p-6 anim-fade-up anim-d2">
                <h3 class="text-white font-semibold mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg text-blue-400">list_alt</span> Saved Records
                </h3>
                <div id="records" class="flex flex-col gap-3">
                    <p class="text-slate-400 text-sm py-4">Loading records...</p>
                </div>
            </div>

        </main>

        <footer
            class="w-full max-w-[1200px] mx-auto px-8 pb-6 pt-2 flex justify-end text-xs text-slate-500 font-medium">
            <p>Powered by Open-Meteo</p>
        </footer>
    </div>

    <script src="app.js"></script>
    <script>
        async function loadRecords() {
            try {
                const items = await jfetch(`${API}/queries`);
                if (!items.length) {
                    $('records').innerHTML = '<p class="text-slate-400 text-sm py-4 text-center">No records yet. Create your first weather query above!</p>';
                    return;
                }
                $('records').innerHTML = items.map((r, idx) => `
      <div class="record-item rounded-xl p-4 bg-white/5 anim-slide-in" style="animation-delay:${idx * 0.05}s">
        <div class="flex flex-wrap items-start justify-between gap-3">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-1">
              <span class="material-symbols-outlined text-primary !text-[18px]">location_on</span>
              <span class="text-white font-semibold">${r.location}</span>
              <span class="text-slate-500 text-xs font-mono">#${r.id}</span>
            </div>
            <div class="flex items-center gap-2 text-sm text-slate-400 mb-1.5">
              <span class="material-symbols-outlined !text-[16px]">date_range</span>
              ${r.start_date} → ${r.end_date}
            </div>
            <p class="text-sm text-slate-300">${r.summary}</p>
          </div>
          <div class="flex gap-2">
            <button onclick="editItem(${r.id})" class="px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 text-slate-300 text-xs font-medium transition-all flex items-center gap-1.5">
              <span class="material-symbols-outlined !text-[14px]">update</span> Update
            </button>
            <button onclick="deleteItem(${r.id})" class="px-3 py-1.5 rounded-lg bg-rose-500/10 border border-rose-500/20 hover:bg-rose-500/20 text-rose-300 text-xs font-medium transition-all flex items-center gap-1.5">
              <span class="material-symbols-outlined !text-[14px]">delete</span> Delete
            </button>
          </div>
        </div>
      </div>
    `).join('');
            } catch (e) { showError('error', e.message); }
        }

        window.editItem = async (id) => {
            try {
                const t = new Date();
                const s = t.toISOString().slice(0, 10);
                const e = new Date(t.getTime() + 86400000).toISOString().slice(0, 10);
                await jfetch(`${API}/queries/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ start_date: s, end_date: e })
                });
                loadRecords();
            } catch (err) { showError('error', err.message); }
        };

        window.deleteItem = async (id) => {
            try {
                await jfetch(`${API}/queries/${id}`, { method: 'DELETE' });
                loadRecords();
            } catch (err) { showError('error', err.message); }
        };

        $('createBtn').onclick = async () => {
            try {
                showError('error');
                const loc = $('qLocation').value.trim();
                if (!loc) return showError('error', 'Enter a location');
                await jfetch(`${API}/queries`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        location: loc,
                        start_date: $('startDate').value,
                        end_date: $('endDate').value
                    })
                });
                $('qLocation').value = '';
                loadRecords();
            } catch (e) { showError('error', e.message); }
        };

        $('refreshBtn').onclick = loadRecords;
        $('exportJson').onclick = () => window.open(`${API}/export/json`, '_blank');
        $('exportCsv').onclick = () => window.open(`${API}/export/csv`, '_blank');
        $('exportMd').onclick = () => window.open(`${API}/export/md`, '_blank');

        loadRecords();
    </script>
</body>

</html>